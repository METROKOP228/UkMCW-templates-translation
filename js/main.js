const replacements_id = {
    "=y": "=т",
    "ID table": "ID таблиця",
    "editions": "видання",
    "{{edition|": "{{el|",
    "firstcolumnname": "назвапершогостовпця",
    "nonameid": "немаєназвиid",
    "notnamespaced": "безінтервалуміжіменами",
    "shownumericids": "показатичисловийid",
    "showaliasids": "показатипсевдонімиid",
    "showfluidtags": "показатитеґирідини",
    "showblocktags": "показатитеґиблока",
    "edition": "видання",
    "showitemtags": "показатитеґипредмета",
    "showentitytags": "показатитеґисутности",
    "showforms": "показатиформи",
    "notshowbeitemforms": "непоказуватиформипредмету",
    "itemform": "формапредмету",
    "itemform2": "формапредмету2",
    "generatetranslationkeys": "генеруватиключіперекладу",
    "nocat": "некат",
    "displayname": "відображуванеім'я",
    "spritename": "назваспрайту",
    "nameid": "назваid",
    "aliasid": "псевдонімиid",
    "fluidtags": "теґирідини",
    "blocktags": "теґиблока",
    "itemtags": "теґипредмета",
    "entitytags": "теґисутности",
    "translationkey": "ключперекладу",
    "translationtype": "типперекладу",
    "foot=": "підвал=",
    "foot =": "підвал =",
    "spritetype=block": "типспрайту=блок",
    "spritetype=item": "типспрайту=предмет",
    "spritetype=entity": "типспрайту=сутність",
    "spritetype=biome": "типспрайту=біом",
    "spritetype=environment": "типспрайту=оточення",
    "spritetype=env": "типспрайту=оточення",
    "spritetype=effect": "типспрайту=ефект",
    "form=block": "форма=блок",
    "form=item": "форма=предмет",
    "form=entity": "форма=сутність",
    "form=biome": "форма=біом",
    "form=environment": "форма=оточення",
    "form=effect": "форма=ефект",
    "form": "форма",
    "Block entity": "Блок-сутність"
};
const replacements_sound = {
    "SoundLine": "ЗвуковийРядок",
    "SoundTable": "ЗвуковаТаблиця",
    "Sound table": "Звукова таблиця",
    "sound": "звук",
    "sound1": "звук1",
    "sound2": "звук2",
    "sound3": "звук3",
    "sound4": "звук4",
    "sound5": "звук5",
    "sound6": "звук6",
    "sound7": "звук7",
    "sound8": "звук8",
    "subtitle=": "субтитри=",
    "source=block": "джерело=блок",
    "description": "опис",
    "translationkey": "ключперекладу",
    "pitch": "висотазвуку",
    "distance": "відстань",
    "rowspan": "рядки",
    "volume": "гучність",
    "foot=": "підвал=",
    "nocat": "некат",
    "type": "тип",
    "Baby:": "Дитинча:",
    "=''varies''": "=''варіюється''",
    "=master": "=загальне",
    "=music": "=музика",
    "=record": "=платівка",
    "=weather": "=погода",
    "=hostile": "=ворожі",
    "=neutral": "=нейтральні",
    "=player": "=гравець",
    "source": "джерело",
    "=ambient": "=середовище",
    "voice": "голос",
    "dependent": "залежний",
    "''None''": "''Немає''",
    "templatepage": "сторінкашаблону",
    "overridesource": "перевизначитиджерело",
    "idnote": "idнотатка",
    "translationkeynote": "ключперекладунотатка"
};
const replacements_vn = {
    "Version nav": "Версія навігація",
    "version nav": "Версія навігація",
    "Infobox version": "Версія навігація",
    "infobox version": "Версія навігація",
    "othereditions": "іншівидання",
    "edition": "видання",
    "title": "назва",
    "|server": "|сервер",
    "| server": "| сервер",
    "prefix": "префікс",
    "image": "зобр",
    "name": "ім'я",
    "|client": "|клієнт",
    "| client": "| клієнт",
    "build": "збірка",
    "internal": "внутрішній",
    "versioncode": "кодверсії",
    "prevparent": "поперверсія",
    "|prev": "|попер",
    "| prev": "| попер",
    "nextparent": "настверсія",
    "next": "наст",
    "type": "тип",
    "unreleased": "невипущено",
    "planned": "заплановано",
    "|date": "|дата",
    "| date": "| дата",
    "compiled": "скомпільований",
    "devversions": "поперзбірки",
    "version": "версія",
    "hash": "хеш",
    "downloads": "завантаження",
    "file": "файл",
    "other": "інше",
    "maps": "карти",
    "map": "карта",
    "protocol_manual": "протокол_вручну",
    "data_manual": "дані_вручну",
    "no_protocol": "немає_протоколу",
    "no_data": "немає_даних",
    "no_": "немає_",
    "_manual": "_вручну",
    "parent": "знімокдля",
    "{{vl": "{{вер",
    "dl=": "зп=",
    "dl =": "зп =",
    "Client": "Клієнт",
    "Server": "Сервер",
    "editorver": "editorвер",
    "No corresponding server": "Немає відповідного сервера"
};
const replacements_entity = {
    "health": "здоров'я",
    "armor": "обладунки",
    "behavior": "поведінка",
    "classification": "класифікація",
    "family": "сімейство",
    "damage": "атака",
    "size": "розмір",
    "group": "група",
    "speed": "швидкість",
    "knockbackresistance": "стійкістьдовіддачі",
    "spawn": "спавн",
    "equipment": "екіпірування",
    "usableitems": "корисніпредмети",
    "rarity": "рідкісність",
    "notes": "примітки",
    "invimage": "інвзображення",
    "image": "зобр",
    "{{Infobox entity": "{{Сутність",
    "{{Entity": "{{Сутність",
    "{{hp": "{{оз",
    "{{drop": "{{дроп",
    "caption": "підпис"
};
const replacements_block = {
    "Infobox block": "Блок",
    "rarity": "рідкісність",
    "renewable": "поновл",
    "stackable": "склад",
    "tool": "інструмент",
    "title": "назва",
    "hardness": "міцн",
    "durability": "стійкість",
    "light": "світ",
    "transparent": "прозор",
    "waterloggable": "затопл",
    "heals": "відн",
    "flammable": "займист",
    "lavasusceptible": "загорвлави",
    "=No": "=Ні",
    "= No": "= Ні",
    "=Yes": "=Так",
    "= Yes": "= Так",
    "invimage": "інвзображення",
    "image": "зобр",
    "group": "група",
    "caption": "підпис",
    "extratext": "додатковийтекст"
};
const replacements_drops = {
    "DropsTableHead": "Голова таблиці дропу",
    "DropsLine": "Рядок дропу",
    "DropsTableFoot": "Підвал таблиці дропу",
    "version": "версія",
    "image": "зобр",
    "namelink": "посиланняназви",
    "namenote": "нотатканазви",
    "name": "назва",
    "rollchancenote": "нотаткашансунауспіх",
    "rollchance": "шанснауспіх",
    "lootingquantity": "кількістьзграбунком",
    "quantitylimit": "обмежкількости",
    "dropchance": "шансдропу",
    "lootingchance": "шансзграбунком",
    "playerkill": "вбивствогравця",
    "=yes": "=так",
    "=no": "=ні",
    "quantity": "кількість"
};
const replacements_history = {
    "HistoryTable": "ТаблицяІсторії",
    "HistoryLine": "РядокІсторії",
    "|dev": "|збірка",
    "|slink": "|поперпосилання",
    "|link": "|посилання",
    "|experiment": "|експеримент",
    "|exp": "|експ",
    "[[File:": "[[Файл:"
};
const replacements_looming = {
    "{{Looming": "{{Ткацтво",
    "{{looming": "{{ткацтво",
    "|head": "|голова",
    "| head": "| голова",
    "|foot": "|підвал",
    "| foot": "| підвал",
    "name": "назва",
    "Blink": "СтягПосилання",
    "Olink": "ВихідПосилання",
    "showdescription": "показатиопис",
    "description": "опис",
    "ingredients": "інгредієнти"
};

const monthes = {
    "January": "січня",
    "February": "лютого",
    "March": "березня",
    "April": "квітня",
    "May": "травня",
    "June": "червня",
    "July": "липня",
    "August": "серпня",
    "September": "вересня",
    "October": "жовтня",
    "November": "листопада",
    "December": "грудня"
};

CodeMirror.defineSimpleMode("customMode", {
    start: [
        { regex: /\<\-\-.*?\-\-\>/, token: "custom-comment" },             // Comments ( <-- something --> )
        // { regex: /\{\{\#.*?\}\}/, token: "custom-parser" },             // Parser functions ( {{#something}} )
        { regex: /==.*==/, token: "custom-heading" },                      // Headings ( == something == )
        { regex: /\{\{\{.*?\}\}\}/, token: "custom-parameter" },           // Parameters ( {{{something}}} )
        { regex: /\{\{/, token: "custom-template", next: "template" },     // Templates ( {{ )
        { regex: /\}\}/, token: "custom-template" },                       // Templates ( }} )
        { regex: /\|/, token: "custom-template" },                         // Pipes ( | )
        { regex: /\[\[(?:(?!\]\]|\|).)*\]\]/, token: "custom-link" },      // Links ( [[something]] )
        { regex: /\[\[(.*?)\|/, token: "custom-link" },                    // Links ( [[something| )
        { regex: /\]\]/, token: "custom-link" },                           // Links ( ]] )
        { regex: /\<.*?\>/, token: "custom-tag" },                         // HTML tags ( <something></something> )
    ],
    template: [
        { regex: /\b([^\|\}\n]+)/, token: "custom-template-name", next: "start" }, // Template name without {{ and |, until | or }}
        { regex: /#([^\|\}\n]+)/, token: "custom-parser-name", next: "start" },    // Parser name without {{ and |, until | or }}
        { regex: /\}\}/, token: "custom-template", next: "start" },                // Template closing ( }} )
        { regex: /\|/, token: "custom-template" },                                 // Pipes within template
    ]
});

var editor = CodeMirror.fromTextArea(document.getElementById("textareaInput"), {
    lineNumbers: true,
    lineWrapping: true,
    mode: "customMode",
    theme: "default"
});

var output = CodeMirror.fromTextArea(document.getElementById("textareaOutput"), {
    lineWrapping: true,
    readonly: true,
    mode: "",
    theme: "default"
});
output.setOption("readOnly", "nocursor");

const textareaInput = editor.getValue();

function translatetext() {
    let radioButtons = document.getElementsByName('modes');
    for (let i = 0; i < radioButtons.length; i++) {
        if (radioButtons[i].checked) {
            let id = radioButtons[i].id;
            console.log(id);
            if (id === "mc-template") {
                translateuk();
            } else if (id === "mc-name") {
                translateNames();
            }
        }
    }
}

function translateuk() {
    const text = editor.getValue();

    let radioButtons = document.getElementsByName('templates');

    for (let i = 0; i < radioButtons.length; i++) {
        if (radioButtons[i].checked) {
            let id = radioButtons[i].id;
            console.log(id);

            if (id === 'auto') {
                console.log('yea')
                console.log(text);
                if (text.includes('{{ID table')) {
                    id_table(text);
                } else if (text.includes('{{Sound table') || text.includes('{{SoundTable')) {
                    sound_table(text);
                } else if (text.includes('{{Version nav') || text.includes('{{Infobox version') || text.includes('{{infobox version')) {
                    version_nav(text);
                } else if (text.includes('{{Entity') || text.includes('{{Infobox entity')) {
                    entity(text);
                } else if (text.includes('{{Infobox block')) {
                    block(text);
                } else if (text.includes('{{Drops')) {
                    dropsTable(text);
                } else if (text.includes('{{History')) {
                    historyTable(text);
                } else if (text.includes('{{Looming')) {
                    looming(text);
                } else if (text === "") {
                    output.setValue("Введіть справжній текст шаблона, а не пустоту");
                } else {
                    output.setValue("Неможливо розпізнати шаблон");
                }
            } else if (id === 'id') {
                id_table(text);
            } else if (id === 'sound') {
                sound_table(text);
            } else if (id === 'vn') {
                version_nav(text);
            } else if (id === 'entity') {
                entity(text);
            } else if (id === 'block') {
                block(text);
            } else if (id === 'drops') {
                dropsTable(text);
            } else if (id === 'historyTable') {
                historyTable(text);
            } else if (id === 'looming') {
                looming(text);
            }
            return;
        }
    }
}

function performReplacements(text, replacementsObject) {
    for (let key in replacementsObject) {
        if (replacementsObject.hasOwnProperty(key)) {
            let regex = new RegExp(key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
            text = text.replace(regex, replacementsObject[key]);
        }
    }
    return text;
}

function highlightAdditions(oldText, text, elClass) {
    output.setValue(text);
    let oldLines = oldText.split("\n");
    let newLines = text.split("\n");

    for (let i = 0; i < newLines.length; i++) {
        if (i >= oldLines.length) {
            // Якщо новий рядок довший ніж старий, виділити всю частину нового рядка
            let pos = output.indexFromPos({line: i, ch: 0});
            let from = output.posFromIndex(pos);
            let to = output.posFromIndex(pos + newLines[i].length);
            output.markText(from, to, {
                className: elClass === undefined ? "cm-diff-added-green" : elClass,
                inclusiveLeft: false,
                inclusiveRight: false
            });
            continue;
        }

        let oldWords = oldLines[i].split(/\s+/);
        let newWords = newLines[i].split(/\s+/);

        let pos = output.indexFromPos({line: i, ch: 0});

        for (let j = 0; j < newWords.length; j++) {
            if (j >= oldWords.length || oldWords[j] !== newWords[j]) {
                let from = output.posFromIndex(pos);
                let to = output.posFromIndex(pos + newWords[j].length);

                output.markText(from, to, {
                    className: elClass === undefined ? "cm-diff-added-green" : elClass,
                    inclusiveLeft: false,
                    inclusiveRight: false
                });
            }

            pos += newWords[j].length + 1;
        }
    }
}


function id_table(text) {
    let oldText = text;
    let edition;
    text = performReplacements(text, replacements_id);
    text = text.split("\n");
    for (let i = 1; i < text.length; i++) {
        if (text[i].includes('java') || text[i].includes('je') || text[i].includes('JE')) {
            edition = "java";
        } else if (text[i].includes('bedrock') || text[i].includes('be') || text[i].includes('BE')) {
            edition = "bedrock";
        }
        
        if (text[i].includes("відображуванеім'я")) {
            console.log(edition);
            switch (edition) {
            case "bedrock":
                text[i] = translateBedrock(text[i]);
                break;
            default:
                text[i] = translateJava(text[i]);
                break;
            }
        }
    }
    text = text.join("\n");
    highlightAdditions(oldText, text);
}

function sound_table(text) {
    highlightAdditions(text, text
        .split("\n")
        .map(segment => segment.includes("subtitle") ? translateJava(performReplacements(segment, replacements_sound)) : performReplacements(segment, replacements_sound))
        .join("\n"));
}

function version_nav(text) {
    let oldText = text;
    text = performReplacements(text, replacements_vn);
    let lines = text.split("\n");

    for (let line of lines) {
        if (line.includes('зобр2')) {
            image2_line = line;
            let edition = null;
            m = image2_line.replace('.png', 'Тут потрібно розрізати');
            if (m.includes('Bedrock')) {
                if (m.includes('Edition')) {
                    m = m.replace("Bedrock Edition ", "Тут потрібно розрізати");
                } else {
                    m = m.replace("Bedrock ", "Тут потрібно розрізати");
                }
                edition = "Bedrock";
            } else if (m.includes('Pocket')) {
                m = m.replace("Pocket Edition ", "Тут потрібно розрізати");
                edition = "Pocket";
            } else if (m.includes('Windows 10')) {
                m = m.replace("Windows 10 Edition ", "Тут потрібно розрізати");
                edition = "Windows 10";
            } else if (m.includes('Java')) {
                m = m.replace("Java Edition ", "Тут потрібно розрізати");
                edition = "Java";
            }
            m = m.split("Тут потрібно розрізати");
            if (edition !== null) {
                let changed_image_line = m[0] + m[1] + " (" + edition + " Edition) меню.png" + m[2];
                text = text.replace(image2_line, changed_image_line)
            }
        } else if (line.includes('дата')) {
            text = text.replace(line, dateTranslation(line));
        }
    }
    highlightAdditions(oldText, text);
}

function entity(text) {
    highlightAdditions(text, text
        .split("\n")
        .map(segment => (segment.includes("invimage") || segment.includes("usableitems") || segment.includes("{{drop")) ? translateJava(performReplacements(segment, replacements_entity)) : performReplacements(segment, replacements_entity))
        .join("\n"));
}

function block(text) {
    highlightAdditions(text, text
        .split("\n")
        .map(segment => segment.includes("invimage") ? translateJava(performReplacements(segment, replacements_block)) : performReplacements(segment, replacements_block))
        .join("\n"));
}

function dropsTable(text) {
    highlightAdditions(text, text
        .split("|")
        .map(segment => segment.includes("name") ? translateJava(performReplacements(segment, replacements_drops)) : performReplacements(segment, replacements_drops))
        .join("|"));
}

function historyTable(text) {
    let oldText = text;
    text = performReplacements(text, replacements_history);
    text = text.split("|");
    for (let i = 0; i < text.length; i++) {
        for (let month in monthes) {
            if (text[i].includes(month)) {
                text[i] = dateTranslation(text[i]);
            }
        }
    }
    text = text.join("|");
    highlightAdditions(oldText, text);
}

function looming(text) {
    let oldText = text;
    const colors = {
        "White": { n: "Білий", f: "білою", m: "білим", pl: "білими" },
        "Light Gray": { n: "Світло-сірий", f: "світло-сірою", m: "світло-сірим", pl: "світло-сірими" },
        "Gray": { n: "Сірий", f: "сірою", m: "сірим", pl: "сірими" },
        "Black": { n: "Чорний", f: "чорною", m: "чорним", pl: "чорними" },
        "Brown": { n: "Коричневий", f: "коричневою", m: "коричневим", pl: "коричневими" },
        "Red": { n: "Червоний", f: "червоною", m: "червоним", pl: "червоними" },
        "Orange": { n: "Помаранчевий", f: "помаранчевою", m: "помаранчевим", pl: "помаранчевими" },
        "Yellow": { n: "Жовтий", f: "жовтою", m: "жовтим", pl: "жовтими" },
        "Lime": { n: "Лаймовий", f: "лаймовою", m: "лаймовим", pl: "лаймовими" },
        "Green": { n: "Зелений", f: "зеленою", m: "зеленим", pl: "зеленими" },
        "Cyan": { n: "Бірюзовий", f: "бірюзовою", m: "бірюзовим", pl: "бірюзовими" },
        "Light Blue": { n: "Блакитний", f: "блакитною", m: "блакитним", pl: "блакитними" },
        "Blue": { n: "Синій", f: "синьою", m: "синім", pl: "синіми" },
        "Purple": { n: "Фіолетовий", f: "фіолетовою", m: "фіолетовим", pl: "фіолетовими" },
        "Magenta": { n: "Пурпуровий", f: "пурпуровою", m: "пурпуровим", pl: "пурпуровими" },
        "Pink": { n: "Рожевий", f: "рожевою", m: "рожевим", pl: "рожевими" }
    };
    const bannerPatterns = {
        "Pale Dexter": { n: "Вертикальна смуга зліва", r: "вертикальною смугою зліва", vid: "f" },
        "Pale Sinister": { n: "Вертикальна смуга справа", r: "вертикальною смугою справа", vid: "f" },
        "Fess": { n: "Пояс", r: "поясом", vid: "m" },
        "Paly": { n: "Вертикальні смуги", r: "вертикальними смугами", vid: "pl" },
        "Saltire": { n: "Косий хрест", r: "косим хрестом", vid: "m" },
        "Cross": { n: "Хрест", r: "хрестом", vid: "m" },
        "Per Bend Sinister": { n: "Верхня ліва половина", r: "верхньою лівою половиною", vid: "f" },
        "Per Bend Inverted": { n: "Нижня ліва половина", r: "нижньою лівою половиною", vid: "f" },
        "Per Bend Sinister Inverted": { n: "Нижня права половина", r: "нижньою правою половиною", vid: "f" },
        "Bend Sinister": { n: "Діагональ справа наліво", r: "діагоналлю справа наліво", vid: "f" },
        "Per Bend": { n: "Верхня права половина", r: "верхньою правою половиною", vid: "f" },
        "Per Pale Inverted": { n: "Права половина", r: "правою половиною", vid: "f" },
        "Per Pale": { n: "Ліва половина", r: "лівою половиною", vid: "f" },
        "Per Fess Inverted": { n: "Нижня половина", r: "нижньою половиною", vid: "f" },
        "Per Fess": { n: "Верхня половина", r: "верхньою половиною", vid: "f" },
        "Base Dexter Canton": { n: "Криж зліва знизу", r: "крижем зліва знизу", vid: "m" },
        "Base Sinister Canton": { n: "Криж справа знизу", r: "крижем справа знизу", vid: "m" },
        "Chief Dexter Canton": { n: "Криж зліва згори", r: "крижем зліва згори", vid: "m" },
        "Chief Sinister Canton": { n: "Криж справа згори", r: "крижем зліва згори", vid: "m" },
        "Inverted Chevron": { n: "Шеврон згори", r: "шевроном згори", vid: "m" },
        "Chevron": { n: "Шеврон", r: "шевроном", vid: "m" },
        "Base Indented": { n: "Зубці знизу", r: "зубцями знизу", vid: "pl" },
        "Chief Indented": { n: "Зубці згори", r: "зубцями згори", vid: "pl" },
        "Roundel": { n: "Круг", r: "кругом", vid: "m" },
        "Lozenge": { n: "Ромб", r: "ромбом", vid: "m" },
        "Bordure Indented": { n: "Зубчата рамка", r: "зубчатою рамкою", vid: "f" },
        "Bordure": { n: "Рамка", r: "рамкою", vid: "f" },
        "Field Masoned": { n: "Цегляний фон", r: "цегляним фоном", vid: "m" },
        "Base Gradient": { n: "Градієнт знизу", r: "градієнтом знизу", vid: "m" },
        "Gradient": { n: "Градієнт згори", r: "градієнтом згори", vid: "m" },
        "Creeper Charge": { n: "Емблема кріпера", r: "емблемою кріпера", vid: "f" },
        "Skull Charge": { n: "Емблема черепа", r: "емблемою черепа", vid: "f" },
        "Flower Charge": { n: "Емблема квітки", r: "емблемою квітки", vid: "f" },
        "Thing": { n: "Річ", r: "річчю", vid: "f" },
        "Globe": { n: "Глобус", r: "глобусом", vid: "m" },
        "Snout": { n: "Рило", r: "рилом", vid: "m" },
        "Flow": { n: "Плин", r: "плином", vid: "m" },
        "Guster": { n: "Порив", r: "поривом", vid: "m" },
        "Base": { n: "Основа", r: "основою", vid: "f" },
        "Bend": { n: "Діагональ зліва направо", r: "діагоналлю зліва направо", vid: "f" },
        "Pale": { n: "Стовп", r: "стовпом", vid: "m" },
        "Chief": { n: "Верх", r: "верхом", vid: "m" }
    };

    const regex = /(?:^|\[|=|\|)([^\|\]\[=\n]*?Banner[^\|\]\[=\n]*?)(?=\||\]|\n|$)/g;

    const matches = [];
    let match;
    while ((match = regex.exec(text)) !== null) {
        matches.push(match[1]);
    }

    for (let match of matches) {
        let usedColor;
        let usedPattern;
        let vidm;

        for (let color in colors) {
            if (match.includes(color)) {
                usedColor = color;
                break;
            }
        }

        for (let pattern in bannerPatterns) {
            if (match.includes(pattern)) {
                usedPattern = pattern;
                vidm = bannerPatterns[pattern].vid;
                break;
            }
        }

        if (usedPattern !== undefined)  {
            if (usedColor !== undefined) {
                if (match.includes("Dyed")) {
                    text = text.replace(match, `Пофарбований стяг з ${colors[usedColor][vidm]} ${bannerPatterns[usedPattern].r}`);
                } else {
                    text = text.replace(match, `Стяг з ${colors[usedColor][vidm]} ${bannerPatterns[usedPattern].r}`);
                }
            } else if (match.includes("Dyed")) {
                text = text.replace(match, `Пофарбований стяг з ${bannerPatterns[usedPattern].r}`);
            } else if (match.includes("Banner Pattern")) {
                text = text.replace(match, `Шаблон стяга з ${bannerPatterns[usedPattern].r}`);
            } else {
                text = text.replace(match, `Стяг з ${bannerPatterns[usedPattern].r}`);
            }
        } else if (usedColor !== undefined) {
            text = text.replace(match, `${colors[usedColor].n} стяг`);
        }
    }

    for (let pattern in bannerPatterns) {
        if (text.includes(pattern)) {
            text = text.replace(pattern, bannerPatterns[pattern].n);
        }
    }

    text = text.split("\n");

    for (let line of text) {
        if (line.includes("Banner")) {
            line = line.replace("Banner", "Стяг");
        }
    }

    text = text.join("\n");

    highlightAdditions(oldText, translateJava(performReplacements(text, replacements_looming)));
}

function dateTranslation(date) {
    let lines1;
    let date_line_new = date;
    let date_line_after = "";
    if (date.includes("<")) {
        lines1 = date.split("<");
        date_line_new = lines1[0];
        date_line_after = '<' + lines1.slice(1).join('<');
    } if (date.includes("{{")) {
        lines1 = date.split("{{");
        date_line_new = lines1[0];
        date_line_after = '{{' + lines1.slice(1).join('{{');
    } if (date.includes("}}")) {
        lines1 = date.split("}}");
        date_line_new = lines1[0];
        date_line_after = '}}' + lines1.slice(1).join('}}');
    }
    for (let [engMonth, ukrMonth] of Object.entries(monthes)) {
        if (date_line_new.includes(`${engMonth} `) && date_line_new.includes(',')) {
            let d = date_line_new.replace(',', 'Розрізати'); 
            d = d.replace(`${engMonth} `, 'Розрізати');
            d = d.split('Розрізати');
            let changed_date_line = d[0] + d[1] + ' ' + ukrMonth + d[2] + ' року' + date_line_after;

            let regexDate = new RegExp('.*\\d{1,2}.+\\d{4} року', 'g');

            if (regexDate.test(changed_date_line)) {
                console.log(`success: ${date}`);
                return changed_date_line;
            } else {
                console.log(`unsuccess: ${date}`);
                return date;
            }
        }
    }

    return date;
}

function copy() {
    // Створення тимчасового textarea
    let textarea = document.createElement('textarea');
    textarea.value = output.getValue();
    document.body.appendChild(textarea);
    
    // Вибір тексту
    textarea.select();
    textarea.setSelectionRange(0, textarea.value.length); // Для мобільних пристроїв
    
    // Копіювання тексту
    document.execCommand('copy');
    
    // Видалення textarea
    document.body.removeChild(textarea);

    alert("Текст скопійовано!");
}

const timeTracker = document.querySelector('.timeTracker');

let intervalId = null; // Define intervalId outside the function to make it global

function timeTracking() {
    let startTime = performance.now();
    let previousValue = output.getValue();
    let intervalId = null;

    clearInterval(intervalId);

    intervalId = setInterval(function() {
        if (output.getValue() !== previousValue) {
            let endTime = performance.now();
            previousValue = output.getValue();
            let durationInSeconds = (endTime - startTime) / 1000;
            let durationRounded = durationInSeconds.toFixed(3);

            if (output.getValue() !== '') {
                timeTracker.textContent = `Час виконання: ${durationRounded} секунди`;
            } else {
                timeTracker.textContent = 'Час виконання: 0 секунд';
            }
        }
    }, 10);
}

document.getElementById('regex-search').addEventListener('change', function() {
    if (this.checked) {
        document.getElementById('regex-slash').classList.remove('hidden');
        document.getElementById('regex-slash2').classList.remove('hidden');
        if (document.getElementById('cs-search').checked) {
            document.getElementById('regex-slash2').textContent = "/g";
        } else {
            document.getElementById('regex-slash2').textContent = "/gi";
        }
    } else {
        document.getElementById('regex-slash').classList.add('hidden');
        document.getElementById('regex-slash2').classList.add('hidden');
    }
});

document.getElementById('cs-search').addEventListener('change', function() {
    if (document.getElementById('regex-search').checked) {
        if (this.checked) {
            document.getElementById('regex-slash2').textContent = "/g";
        } else {
            document.getElementById('regex-slash2').textContent = "/gi";
        }
    }
});

function toggleMenu() {
    const menu = document.getElementById('settingsMenu');
    const overlay = document.getElementById('overlay');
    if (menu.style.display === 'none' || menu.style.display === '') {
        menu.style.display = 'block';
        overlay.style.display = 'block';
    } else {
        menu.style.display = 'none';
        overlay.style.display = 'none';
    }
}

function clearTextareas() {
    editor.setValue('');
    output.setValue('');
}

function updateSettings() {
    var bgColor = document.getElementById('bg-color').value;
    var textColor = document.getElementById('text-color').value;
    var btnHvBgColor = document.getElementById('btn-hover-bg-color').value;
    var btnHvTextColor = document.getElementById('btn-hover-text-color').value;
    var linkColor = document.getElementById('link-color').value;
    var linkHvColor = document.getElementById('link-hover-color').value;
    document.documentElement.style.setProperty('--bg-color', bgColor);
    document.documentElement.style.setProperty('--alt-color', textColor);
    document.documentElement.style.setProperty('--btn-hover-bg-color', btnHvBgColor);
    document.documentElement.style.setProperty('--btn-hover-text-color', btnHvTextColor);
    document.documentElement.style.setProperty('--link-color', linkColor);
    document.documentElement.style.setProperty('--link-hover-color', linkHvColor);

    
    localStorage.setItem('bgColor', bgColor);
    localStorage.setItem('textColor', textColor);
    localStorage.setItem('btnHvBgColor', btnHvBgColor);
    localStorage.setItem('btnHvTextColor', btnHvTextColor);
    localStorage.setItem('linkColor', linkColor);
    localStorage.setItem('linkHvColor', linkHvColor);
}

document.addEventListener('DOMContentLoaded', (event) => {
    // Завантаження збережених налаштувань
    const savedBgColor = localStorage.getItem('bgColor');
    const savedTextColor = localStorage.getItem('textColor');
    const savedBtnHvBgColor = localStorage.getItem('btnHvBgColor');
    const savedBtnHvTextColor = localStorage.getItem('btnHvTextColor');
    const savedLinkColor = localStorage.getItem('linkColor');
    const savedLinkHvColor = localStorage.getItem('linkHvColor');

    if (savedBgColor) {
        document.documentElement.style.setProperty('--bg-color', savedBgColor);
        document.getElementById('bg-color').value = savedBgColor;
    }

    if (savedTextColor) {
        document.documentElement.style.setProperty('--alt-color', savedTextColor);
        document.getElementById('text-color').value = savedTextColor;
    }

    if (savedBtnHvBgColor) {
        document.documentElement.style.setProperty('--btn-hover-bg-color', savedBtnHvBgColor);
        document.getElementById('btn-hover-bg-color').value = savedBtnHvBgColor;
    }

    if (savedBtnHvTextColor) {
        document.documentElement.style.setProperty('--btn-hover-text-color', savedBtnHvTextColor);
        document.getElementById('btn-hover-text-color').value = savedBtnHvTextColor;
    }

    if (savedLinkColor) {
        document.documentElement.style.setProperty('--link-color', savedLinkColor);
        document.getElementById('link-color').value = savedLinkColor;
    }

    if (savedLinkHvColor) {
        document.documentElement.style.setProperty('--link-hover-color', savedLinkHvColor);
        document.getElementById('link-hover-color').value = savedLinkHvColor;
    }
});

function reset() {
    document.getElementById('bg-color').value = '#0000FF';
    document.getElementById('text-color').value = '#FFFF00';
    document.getElementById('btn-hover-bg-color').value = '#A69D00';
    document.getElementById('btn-hover-text-color').value= '#FFFFFF';
    document.getElementById('link-color').value = '#FF0000';
    document.getElementById('link-hover-color').value = '#A60000';
    bgColor = '#0000FF';
    textColor = '#FFFF00';
    btnHvBgColor = '#A69D00';
    btnHvTextColor = '#FFFFFF';
    linkColor = '#FF0000';
    linkHvColor = '#A60000';
    document.documentElement.style.setProperty('--bg-color', bgColor);
    document.documentElement.style.setProperty('--alt-color', textColor);
    document.documentElement.style.setProperty('--btn-hover-bg-color', btnHvBgColor);
    document.documentElement.style.setProperty('--btn-hover-text-color', btnHvTextColor);
    document.documentElement.style.setProperty('--link-color', linkColor);
    document.documentElement.style.setProperty('--link-hover-color', linkHvColor);
    localStorage.setItem('bgColor', bgColor);
    localStorage.setItem('textColor', textColor);
    localStorage.setItem('btnHvBgColor', btnHvBgColor);
    localStorage.setItem('btnHvTextColor', btnHvTextColor);
    localStorage.setItem('linkColor', linkColor);
    localStorage.setItem('linkHvColor', linkHvColor);
}

function presetChoice(bgColor, textColor, btnHvBgColor, btnHvTextColor, linkColor, linkHvColor) {
    document.getElementById('bg-color').value = bgColor;
    document.getElementById('text-color').value = textColor;
    document.getElementById('btn-hover-bg-color').value = btnHvBgColor;
    document.getElementById('btn-hover-text-color').value= btnHvTextColor;
    document.getElementById('link-color').value = linkColor;
    document.getElementById('link-hover-color').value = linkHvColor;
    document.documentElement.style.setProperty('--bg-color', bgColor);
    document.documentElement.style.setProperty('--alt-color', textColor);
    document.documentElement.style.setProperty('--btn-hover-bg-color', btnHvBgColor);
    document.documentElement.style.setProperty('--btn-hover-text-color', btnHvTextColor);
    document.documentElement.style.setProperty('--link-color', linkColor);
    document.documentElement.style.setProperty('--link-hover-color', linkHvColor);
    localStorage.setItem('bgColor', bgColor);
    localStorage.setItem('textColor', textColor);
    localStorage.setItem('btnHvBgColor', btnHvBgColor);
    localStorage.setItem('btnHvTextColor', btnHvTextColor);
    localStorage.setItem('linkColor', linkColor);
    localStorage.setItem('linkHvColor', linkHvColor);
}

const submitButton = document.querySelector('.button-tr');

// Додаємо обробник події на весь документ
document.addEventListener('keydown', function(event) {
    // Перевіряємо, чи натиснуто Enter і чи фокус не знаходиться на інпуті
    if (event.key === 'Enter' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
        // Виконуємо натискання кнопки
        submitButton.click();
    }
});