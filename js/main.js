const replacements_id = {
    "=y": "=т",
    "ID table": "ID таблиця",
    "editions": "видання",
    "{{edition|": "{{el|",
    "firstcolumnname": "назвапершогостовпця",
    "nonameid": "немаєназвиid",
    "notnamespaced": "безінтервалуміжіменами",
    "shownumericids": "показатичисловийid",
    "showaliasids": "показатипсевдонімиid",
    "showfluidtags": "показатитеґирідини",
    "showblocktags": "показатитеґиблоку",
    "edition": "видання",
    "showitemtags": "показатитеґипредмету",
    "showentitytags": "показатитеґисутности",
    "showforms": "показатиформи",
    "notshowbeitemforms": "непоказуватиформипредмету",
    "itemform": "формапредмету",
    "itemform2": "формапредмету2",
    "generatetranslationkeys": "генеруватиключіперекладу",
    "nocat": "некат",
    "displayname": "відображуванеім'я",
    "spritename": "назваспрайту",
    "nameid": "назваid",
    "aliasid": "псевдонімиid",
    "fluidtags": "теґирідини",
    "blocktags": "теґиблоку",
    "itemtags": "теґипредмету",
    "entitytags": "теґисутности",
    "translationkey": "ключперекладу",
    "translationtype": "типперекладу",
    "foot=": "підвал=",
    "foot =": "підвал =",
    "spritetype=block": "типспрайту=блок",
    "spritetype=item": "типспрайту=предмет",
    "spritetype=entity": "типспрайту=сутність",
    "spritetype=biome": "типспрайту=біом",
    "spritetype=environment": "типспрайту=оточення",
    "spritetype=env": "типспрайту=оточення",
    "spritetype=effect": "типспрайту=ефект",
    "form=block": "форма=блок",
    "form=item": "форма=предмет",
    "form=entity": "форма=сутність",
    "form=biome": "форма=біом",
    "form=environment": "форма=оточення",
    "form=effect": "форма=ефект",
    "form": "форма"
};
const replacements_sound = {
    "Sound table": "Звукова таблиця",
    "sound": "звук",
    "sound1": "звук1",
    "sound2": "звук2",
    "sound3": "звук3",
    "sound4": "звук4",
    "sound5": "звук5",
    "sound6": "звук6",
    "sound7": "звук7",
    "sound8": "звук8",
    "subtitle=": "субтитри=",
    "source=block": "джерело=блок",
    "description": "опис",
    "translationkey": "ключперекладу",
    "pitch": "висотазвуку",
    "distance": "відстань",
    "rowspan": "рядки",
    "volume": "гучність",
    "foot=": "підвал=",
    "nocat": "некат",
    "type": "тип",
    "Baby:": "Дитинча:",
    "''varies''": "''варіюється''",
    "master": "загальне",
    "music": "музика",
    "record": "платівка",
    "weather": "погода",
    "hostile": "ворожі",
    "neutral": "нейтральні",
    "player": "гравець",
    "source": "джерело",
    "ambient": "середовище",
    "voice": "голос",
    "dependent": "залежний",
    "''None''": "''Немає''",
    "templatepage": "сторінкашаблону",
    "overridesource": "перевизначитиджерело",
    "idnote": "idнотатка",
    "translationkeynote": "ключперекладунотатка"
};
const replacements_vn = {
    "Version nav": "Версія навігація",
    "version nav": "Версія навігація",
    "Infobox version": "Версія навігація",
    "infobox version": "Версія навігація",
    "othereditions": "іншівидання",
    "edition": "видання",
    "title": "назва",
    "|server": "|сервер",
    "| server": "| сервер",
    "prefix": "префікс",
    "image": "зобр",
    "name": "ім'я",
    "|client": "|клієнт",
    "| client": "| клієнт",
    "build": "збірка",
    "internal": "внутрішній",
    "versioncode": "кодверсії",
    "prevparent": "поперверсія",
    "|prev": "| попер",
    "| prev": "| попер",
    "nextparent": "настверсія",
    "next": "наст",
    "type": "тип",
    "unreleased": "невипущено",
    "planned": "заплановано",
    "|date": "| дата",
    "| date": "| дата",
    "compiled": "скомпільований",
    "devversions": "поперзбірки",
    "version": "версія",
    "hash": "хеш",
    "downloads": "завантаження",
    "file": "файл",
    "other": "інше",
    "maps": "карти",
    "map": "карта",
    "protocol_manual": "протокол_вручну",
    "data_manual": "дані_вручну",
    "no_protocol": "немає_протоколу",
    "no_data": "немає_даних",
    "no_": "немає_",
    "_manual": "_вручну",
    "parent": "знімокдля",
    "{{vl": "{{вер",
    "dl=": "зп=",
    "dl =": "зп =",
    "Client": "Клієнт",
    "Server": "Сервер",
    "editorver": "editorвер"
};
const replacements_entity = {
    "health": "здоров'я",
    "armor": "обладунки",
    "behavior": "поведінка",
    "classification": "класифікація",
    "family": "сімейство",
    "damage": "атака",
    "size": "розмір",
    "group": "група",
    "speed": "швидкість",
    "knockbackresistance": "стійкістьдовіддачі",
    "spawn": "спавн",
    "equipment": "екіпірування",
    "usableitems": "корисніпредмети",
    "rarity": "рідкісність",
    "notes": "примітки",
    "invimage": "інвзображення",
    "image": "зобр",
    "{{Infobox entity": "{{Сутність",
    "{{Entity": "{{Сутність",
    "{{hp": "{{оз",
    "{{drop": "{{дроп",
    "caption": "підпис"
};
const replacements_block = {
    "Infobox block": "Блок",
    "rarity": "рідкісність",
    "renewable": "поновл",
    "stackable": "склад",
    "tool": "інструмент",
    "title": "назва",
    "hardness": "міцн",
    "durability": "стійкість",
    "light": "світ",
    "transparent": "прозор",
    "waterloggable": "затопл",
    "heals": "відн",
    "flammable": "займист",
    "lavasusceptible": "загорвлави",
    "=No": "=Ні",
    "= No": "= Ні",
    "=Yes": "=Так",
    "= Yes": "= Так",
    "invimage": "інвзображення",
    "image": "зобр",
    "group": "група",
    "caption": "підпис"
};
const replacements_drops = {
    "DropsTableHead": "Голова таблиці дропу",
    "DropsLine": "Рядок дропу",
    "DropsTableFoot": "Підвал таблиці дропу",
    "version": "версія",
    "image": "зобр",
    "namelink": "посиланняназви",
    "namenote": "нотатканазви",
    "name": "назва",
    "rollchancenote": "нотаткашансунауспіх",
    "rollchance": "шанснауспіх",
    "lootingquantity": "кількістьзграбунком",
    "quantitylimit": "обмежкількости",
    "dropchance": "шансдропу",
    "lootingchance": "шансзграбунком",
    "playerkill": "вбивствогравця",
    "quantity": "кількість"
};

let months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
let months_uk = ['січня', 'лютого', 'березня', 'квітня', 'травня', 'червня', 'липня', 'серпня', 'вересня', 'жовтня', 'листопада', 'грудня'];

var textarea = document.getElementById('textareaOutput');

CodeMirror.defineSimpleMode("customMode", {
    start: [
        { regex: /\<\-\-.*?\-\-\>/, token: "custom-comment" },             // Comments ( <-- something --> )
        // { regex: /\{\{\#.*?\}\}/, token: "custom-parser" },             // Parser functions ( {{#something}} )
        { regex: /==.*==/, token: "custom-heading" },                      // Headings ( == something == )
        { regex: /\{\{\{.*?\}\}\}/, token: "custom-parameter" },           // Parameters ( {{{something}}} )
        { regex: /\{\{/, token: "custom-template", next: "template" },     // Templates ( {{ )
        { regex: /\}\}/, token: "custom-template" },                       // Templates ( }} )
        { regex: /\|/, token: "custom-template" },                         // Pipes ( | )
        { regex: /\[\[(?:(?!\]\]|\|).)*\]\]/, token: "custom-link" },      // Links ( [[something]] )
        { regex: /\[\[(.*?)\|/, token: "custom-link" },                    // Links ( [[something| )
        { regex: /\]\]/, token: "custom-link" },                           // Links ( ]] )
        { regex: /\<.*?\>/, token: "custom-tag" },                         // HTML tags ( <something></something> )
    ],
    template: [
        { regex: /\b([^\|\}\n]+)/, token: "custom-template-name", next: "start" }, // Template name without {{ and |, until | or }}
        { regex: /#([^\|\}\n]+)/, token: "custom-parser-name", next: "start" },    // Parser name without {{ and |, until | or }}
        { regex: /\}\}/, token: "custom-template", next: "start" },                // Template closing ( }} )
        { regex: /\|/, token: "custom-template" },                                 // Pipes within template
    ]
});

var editor = CodeMirror.fromTextArea(document.getElementById("textareaInput"), {
    lineNumbers: true,
    lineWrapping: true,
    mode: "customMode",
    theme: "default"
});

const textareaInput = editor.getValue();

function translatetext() {
    let radioButtons = document.getElementsByName('modes');
    for (let i = 0; i < radioButtons.length; i++) {
        if (radioButtons[i].checked) {
            let id = radioButtons[i].id;
            console.log(id);
            if (id === "mc-template") {
                translateuk();
            } else if (id === "mc-name") {
                translateNames();
            }
        }
    }
}

function translateuk() {
    console.log(editor.getValue());
    const text = editor.getValue();

    let radioButtons = document.getElementsByName('templates');

    for (let i = 0; i < radioButtons.length; i++) {
        if (radioButtons[i].checked) {
            let id = radioButtons[i].id;
            console.log(id);

            if (id === 'auto') {
                console.log('yea')
                console.log(text);
                if (text.includes('{{ID table')) {
                    id_table(text);
                } else if (text.includes('{{Sound table')) {
                    sound_table(text);
                } else if (text.includes('{{Version nav') || text.includes('{{Infobox version') || text.includes('{{infobox version')) {
                    version_nav(text);
                } else if (text.includes('{{Entity') || text.includes('{{Infobox entity')) {
                    entity(text);
                } else if (text.includes('{{Infobox block')) {
                    block(text);
                } else if (text.includes('{{Drops')) {
                    dropsTable(text);
                } else if (text === "") {
                    textarea.value = "Введіть справжній текст шаблона, а не пустоту";
                } else {
                    textarea.value = "Неможливо розпізнати шаблон";
                }
            } else if (id === 'id') {
                id_table(text);
            } else if (id === 'sound') {
                sound_table(text);
            } else if (id === 'vn') {
                version_nav(text);
            } else if (id === 'entity') {
                entity(text);
            } else if (id === 'block') {
                block(text);
            } else if (id === 'drops') {
                dropsTable(text);
            }
            return;
        }
    }
}

function performReplacements(text, replacementsObject) {
    for (let key in replacementsObject) {
        if (replacementsObject.hasOwnProperty(key)) {
            let regex = new RegExp(key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
            text = text.replace(regex, replacementsObject[key]);
        }
    }
    return text;
}

function id_table(text) {
    let edition;
    text = performReplacements(text, replacements_id);
    text = text.split("\n");
    for (let i = 1; i < text.length; i++) {
        if (text[i].includes('java') || text[i].includes('je') || text[i].includes('JE')) {
            edition = "java";
        } else if (text[i].includes('bedrock') || text[i].includes('be') || text[i].includes('BE')) {
            edition = "bedrock";
        }
        
        if (text[i].includes("відображуванеім'я")) {
            console.log(edition);
            switch (edition) {
            case "bedrock":
                text[i] = translateBedrock(text[i]);
                break;
            default:
                text[i] = translateJava(text[i]);
                break;
            }
        }
    }
    text = text.join("\n");
    textarea.value = text;
}

function sound_table(text) {
    text = performReplacements(text, replacements_sound);
    text = text.split("\n");
    for (let i = 1; i < text.length; i++) {
        if (text[i].includes("субтитри")) {
            text[i] = translateJava(text[i]);
        }
    }
    text = text.join("\n");
    textarea.value = text;
}

function version_nav(text) {
    text = performReplacements(text, replacements_vn);
    text = text.split("\n");
    for (let i = 1; i < text.length; i++) {
        if (text[i].includes("субтитри")) {
            text[i] = translateJava(text[i]);
        }
    }
    text = text.join("\n");
    let lines = text.split("\n");

    if (text.includes('зобр2')) {;
        for (let i = 0; i < lines.length; i++) {
            let line = lines[i];
            if (line.includes('зобр2')) {
                image2_line = line;
                break;
            }
        }
        let edition = null;
        m = image2_line.replace('.png', 'Тут потрібно розрізати');
        if (m.includes('Bedrock')) {
            if (m.includes('Edition')) {
                m = m.replace("Bedrock Edition ", "Тут потрібно розрізати");
            } else {
                m = m.replace("Bedrock ", "Тут потрібно розрізати");
            }
            edition = "Bedrock";
        } else if (m.includes('Pocket')) {
            m = m.replace("Pocket Edition ", "Тут потрібно розрізати");
            edition = "Pocket";
        } else if (m.includes('Windows 10')) {
            m = m.replace("Windows 10 Edition ", "Тут потрібно розрізати");
            edition = "Windows 10";
        } else if (m.includes('Java')) {
            m = m.replace("Java Edition ", "Тут потрібно розрізати");
            edition = "Java";
        }
        m = m.split("Тут потрібно розрізати");
        if (edition !== null) {
            let changed_image_line = m[0] + m[1] + " (" + edition + " Edition) меню.png" + m[2];
            text = text.replace(image2_line, changed_image_line)
        }
    }
    if (text.includes('дата')) {
        for (let i = 0; i < lines.length; i++) {
            let d_line = lines[i];
            if (d_line.includes('дата')) {
                date_line = d_line;
                break;
            }
        }

        let lines1 = null;
        let date_line_new = null;
        let date_line_after = null;
        if (date_line.includes("<")) {
            lines1 = date_line.split("<");
            date_line_new = lines1[0];
            date_line_after = '<' + lines1.slice(1).join('<');
        } else if (date_line.includes("{{")) {
            lines1 = date_line.split("{{");
            date_line_new = lines1[0];
            date_line_after = '{{' + lines1.slice(1).join('{{');
        } else {
            date_line_after = '';
            date_line_new = date_line;
        }
        try {
            for (let month = 0; month < months.length; month++) {
                if (date_line_new.includes(months[month])) {
                    let d = date_line_new.replace(',', 'Розрізати'); 
                    d = d.replace(months[month] + " ", 'Розрізати');
                    d = d.split('Розрізати');
                    let changed_date_line = d[0] + d[1] + ' ' + months_uk[month] + d[2] + ' року' + date_line_after;

                    text = text.replace(date_line, changed_date_line);
                }
            }
        } catch (error) {
            console.log("Error in date translation");
        }
    }
    textarea.value = text;
}

function entity(text) {
    text = performReplacements(text, replacements_entity);
    text = text.split("\n");
    for (let i = 1; i < text.length; i++) {
        if (text[i].includes("інвзображення") || text[i].includes("корисніпредмети") || text[i].includes("{{дроп")) {
            text[i] = translateJava(text[i]);
        }
    }
    text = text.join("\n");
    textarea.value = text;
}

function block(text) {
    text = performReplacements(text, replacements_block);
    text = text.split("\n");
    for (let i = 1; i < text.length; i++) {
        if (text[i].includes("інвзображення")) {
            text[i] = translateJava(text[i]);
        }
    }
    text = text.join("\n");
    textarea.value = text;
}

function dropsTable(text) {
    text = performReplacements(text, replacements_drops);
    text = text.split("|");
    for (let i = 0; i < text.length; i++) {
        if (text[i].includes("назва")) {
            text[i] = translateJava(text[i]);
        }
    }
    text = text.join("|");
    textarea.value = text;
}

function copy() {
    const textToCopy = document.getElementById("textareaOutput");
    textToCopy.select();
    document.execCommand("copy");

    const notification = document.getElementById("copy-notification");
    notification.classList.add("show");
    setTimeout(() => {
        notification.classList.remove("show");
    }, 2000);
}

const timeTracker = document.querySelector('.timeTracker');

let intervalId = null; // Define intervalId outside the function to make it global

function timeTracking() {
    let startTime = performance.now();
    let previousValue = textarea.value;
    let intervalId = null;

    clearInterval(intervalId);

    intervalId = setInterval(function() {
        if (textarea.value !== previousValue) {
            previousValue = textarea.value;
            let endTime = performance.now();
            let durationInSeconds = (endTime - startTime) / 1000;
            let durationRounded = durationInSeconds.toFixed(3);

            timeTracker.textContent = `Час виконання: ${durationRounded} секунди`;

            startTime = performance.now();
        }
    }, 100);
}

document.getElementById('regex-search').addEventListener('change', function() {
    if (this.checked) {
        document.getElementById('regex-slash').classList.remove('hidden');
        document.getElementById('regex-slash2').classList.remove('hidden');
        if (document.getElementById('cs-search').checked) {
            document.getElementById('regex-slash2').textContent = "/g";
        } else {
            document.getElementById('regex-slash2').textContent = "/gi";
        }
    } else {
        document.getElementById('regex-slash').classList.add('hidden');
        document.getElementById('regex-slash2').classList.add('hidden');
    }
});

document.getElementById('cs-search').addEventListener('change', function() {
    if (document.getElementById('regex-search').checked) {
        if (this.checked) {
            document.getElementById('regex-slash2').textContent = "/g";
        } else {
            document.getElementById('regex-slash2').textContent = "/gi";
        }
    }
});

function toggleMenu() {
    const menu = document.getElementById('settingsMenu');
    const overlay = document.getElementById('overlay');
    if (menu.style.display === 'none' || menu.style.display === '') {
    menu.style.display = 'block';
    overlay.style.display = 'block';
    } else {
    menu.style.display = 'none';
    overlay.style.display = 'none';
    }
}

function updateSettings() {
    var bgColor = document.getElementById('bg-color').value;
    var textColor = document.getElementById('text-color').value;
    var btnHvBgColor = document.getElementById('btn-hover-bg-color').value;
    var btnHvTextColor = document.getElementById('btn-hover-text-color').value;
    var linkColor = document.getElementById('link-color').value;
    var linkHvColor = document.getElementById('link-hover-color').value;
    document.documentElement.style.setProperty('--bg-color', bgColor);
    document.documentElement.style.setProperty('--alt-color', textColor);
    document.documentElement.style.setProperty('--btn-hover-bg-color', btnHvBgColor);
    document.documentElement.style.setProperty('--btn-hover-text-color', btnHvTextColor);
    document.documentElement.style.setProperty('--link-color', linkColor);
    document.documentElement.style.setProperty('--link-hover-color', linkHvColor);

    
    localStorage.setItem('bgColor', bgColor);
    localStorage.setItem('textColor', textColor);
    localStorage.setItem('btnHvBgColor', btnHvBgColor);
    localStorage.setItem('btnHvTextColor', btnHvTextColor);
    localStorage.setItem('linkColor', linkColor);
    localStorage.setItem('linkHvColor', linkHvColor);
}

document.addEventListener('DOMContentLoaded', (event) => {
    // Завантаження збережених налаштувань
    const savedBgColor = localStorage.getItem('bgColor');
    const savedTextColor = localStorage.getItem('textColor');
    const savedBtnHvBgColor = localStorage.getItem('btnHvBgColor');
    const savedBtnHvTextColor = localStorage.getItem('btnHvTextColor');
    const savedLinkColor = localStorage.getItem('linkColor');
    const savedLinkHvColor = localStorage.getItem('linkHvColor');

    if (savedBgColor) {
        document.documentElement.style.setProperty('--bg-color', savedBgColor);
        document.getElementById('bg-color').value = savedBgColor;
    }

    if (savedTextColor) {
        document.documentElement.style.setProperty('--alt-color', savedTextColor);
        document.getElementById('text-color').value = savedTextColor;
    }

    if (savedBtnHvBgColor) {
        document.documentElement.style.setProperty('--btn-hover-bg-color', savedBtnHvBgColor);
        document.getElementById('btn-hover-bg-color').value = savedBtnHvBgColor;
    }

    if (savedBtnHvTextColor) {
        document.documentElement.style.setProperty('--btn-hover-text-color', savedBtnHvTextColor);
        document.getElementById('btn-hover-text-color').value = savedBtnHvTextColor;
    }

    if (savedLinkColor) {
        document.documentElement.style.setProperty('--link-color', savedLinkColor);
        document.getElementById('link-color').value = savedLinkColor;
    }

    if (savedLinkHvColor) {
        document.documentElement.style.setProperty('--link-hover-color', savedLinkHvColor);
        document.getElementById('link-hover-color').value = savedLinkHvColor;
    }
});

function reset() {
    document.getElementById('bg-color').value = '#0000FF';
    document.getElementById('text-color').value = '#FFFF00';
    document.getElementById('btn-hover-bg-color').value = '#A69D00';
    document.getElementById('btn-hover-text-color').value= '#FFFFFF';
    document.getElementById('link-color').value = '#FF0000';
    document.getElementById('link-hover-color').value = '#A60000';
    bgColor = '#0000FF';
    textColor = '#FFFF00';
    btnHvBgColor = '#A69D00';
    btnHvTextColor = '#FFFFFF';
    linkColor = '#FF0000';
    linkHvColor = '#A60000';
    document.documentElement.style.setProperty('--bg-color', bgColor);
    document.documentElement.style.setProperty('--alt-color', textColor);
    document.documentElement.style.setProperty('--btn-hover-bg-color', btnHvBgColor);
    document.documentElement.style.setProperty('--btn-hover-text-color', btnHvTextColor);
    document.documentElement.style.setProperty('--link-color', linkColor);
    document.documentElement.style.setProperty('--link-hover-color', linkHvColor);
    localStorage.setItem('bgColor', bgColor);
    localStorage.setItem('textColor', textColor);
    localStorage.setItem('btnHvBgColor', btnHvBgColor);
    localStorage.setItem('btnHvTextColor', btnHvTextColor);
    localStorage.setItem('linkColor', linkColor);
    localStorage.setItem('linkHvColor', linkHvColor);
}